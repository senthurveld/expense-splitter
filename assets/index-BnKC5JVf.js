(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();class u{constructor(e){if(!e||typeof e!="string")throw new Error("Username must be a non-empty string");this.name=e.trim(),this.id=this.generateId()}generateId(){return crypto.randomUUID()}toJSON(){return{id:this.id,name:this.name}}}class E{constructor(){this.users=new Map}addUser(e){if(!e)throw new Error("User name is required");const t=e.trim();if(this.users.has(t))throw new Error("User already exists");const s=new u(t);return this.users.set(t,s),s}getUser(e){return this.users.get(e)}getAllUsers(){return Array.from(this.users.values())}getUserNames(){return Array.from(this.users.keys())}hasUser(e){return this.users.has(e)}getUserCount(){return this.users.size}clear(){this.users.clear()}importUsers(e){if(!Array.isArray(e))throw new Error("User data must be an array");e.forEach(t=>{t&&t.name&&this.users.set(t.name,new u(t.name))})}}class h{constructor(e,t,s="No description"){if(!e||typeof e!="string")throw new Error("PaidBy must be a non-empty string");if(!t||typeof t!="number"||t<=0)throw new Error("Amount must be a postive number");this.paidBy=e.trim(),this.amount=parseFloat(t.toFixed(2)),this.description=s,this.timestamp=new Date().toISOString(),this.id=this.generateId()}generateId(){return crypto.randomUUID()}toJSON(){return{id:this.id,paidBy:this.paidBy,amount:this.amount,description:this.description,timestamp:this.timestamp}}}class y{constructor(e){this.expenses=[],this.userService=e}addExpense(e,t,s){if(!this.userService.hasUser(e))throw new Error("User does not exist");const r=new h(e,t,s);return this.expenses.push(r),r}getAllExpenses(){return[...this.expenses]}getExpensesByUser(e){return this.expenses.filter(t=>t.paidBy===e)}clear(){this.expenses=[]}importExpenses(e){if(!Array.isArray(e))throw new Error("Expense data must be an array");const t=e.filter(s=>s&&s.paidBy&&s.amount).map(s=>new h(s.paidBy,s.amount,s.description));this.expenses.push(...t)}simplifyExpenses(){const e=this.userService.getUserCount();if(e===0)return[];const t={},s=this.userService.getUserNames();return s.forEach(r=>{t[r]=0}),this.expenses.forEach(r=>{const n=r.amount/e;s.forEach(i=>{i===r.paidBy?t[i]+=r.amount-n:t[i]-=n})}),this.calculateSettlements(t)}calculateSettlements(e){const t=[],s=Object.keys(e).filter(i=>Math.abs(e[i])>.01);s.sort((i,l)=>e[i]-e[l]);let r=0,n=s.length-1;for(;r<n;){const i=s[n],l=s[r],p=Math.min(-e[l],e[i]);p>.01&&(e[l]+=p,e[i]-=p,t.push(`${l} owes ${i} ₹${p.toFixed(2)}`)),Math.abs(e[l])<.01&&r++,Math.abs(e[i])<.01&&n--}return t}}class g{constructor(e,t){this.userService=e,this.expenseService=t}exportData(){const e={users:this.userService.getAllUsers().map(n=>n.toJSON()),expenses:this.expenseService.getAllExpenses().map(n=>n.toJSON()),exportDate:new Date().toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=`expenses_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}importData(e){return new Promise((t,s)=>{if(!e){s(new Error("No file selected"));return}const r=new FileReader;r.onload=n=>{try{const i=JSON.parse(n.target.result);if(!i.users||!i.expenses)throw new Error("Invalid file format");this.userService.importUsers(i.users),this.expenseService.importExpenses(i.expenses),t(i)}catch(i){s(new Error(`Failed to import data: ${i.message}`))}},r.onerror=()=>{s(new Error("Failed to read file"))},r.readAsText(e)})}}class o{static getElementById(e){const t=document.getElementById(e);if(!t)throw new Error(`Element with id '${e}' not found`);return t}static createListItem(e,t=""){const s=document.createElement("li");return s.textContent=e,t&&(s.className=t),s}static createOption(e,t){return new Option(e,t)}static clearElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}static appendFragment(e,t,s){const r=document.createDocumentFragment();t.forEach(n=>{r.appendChild(s(n))}),e.appendChild(r)}}function m(a){Toastify({text:a,duration:3e3,gravity:"bottom",position:"right",stopOnFocus:!0,style:{background:"rgb(61, 137, 44)"}}).showToast()}function c(a){Toastify({text:a,duration:3e3,gravity:"bottom",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(to right, #8B0000, #FFCCCB)"}}).showToast()}class x{constructor(e,t,s){this.userService=e,this.expenseService=t,this.storageService=s,this.initializeElements(),this.bindEvents(),this.initializeSelectBox()}initializeElements(){this.elements={addUserForm:o.getElementById("addUserForm"),userInput:o.getElementById("userInput"),addExpenseForm:o.getElementById("addExpenseForm"),expenseUserInput:o.getElementById("expenseUserInput"),expenseAmountInput:o.getElementById("expenseAmountInput"),expenseReasonInput:o.getElementById("expenseReasonInput"),simplifyBtn:o.getElementById("simplifyBtn"),exportBtn:o.getElementById("exportBtn"),importBtn:o.getElementById("importBtn"),importFile:o.getElementById("importFile"),resultArea:o.getElementById("resultArea"),paymentList:o.getElementById("payment-list")}}initializeSelectBox(){const e=o.createOption("Select User","");this.elements.expenseUserInput.add(e)}bindEvents(){this.elements.addUserForm.addEventListener("submit",e=>this.handleAddUser(e)),this.elements.addExpenseForm.addEventListener("submit",e=>this.handleAddExpense(e)),this.elements.simplifyBtn.addEventListener("click",()=>this.handleSimplify()),this.elements.exportBtn.addEventListener("click",()=>this.handleExport()),this.elements.importFile.addEventListener("change",e=>this.handleImport(e)),this.elements.exportBtn.addEventListener("click",e=>{e.target.dataset.action==="Export"&&this.handleExport()}),this.elements.importBtn.addEventListener("click",e=>{this.elements.importFile.click()})}async handleAddUser(e){e.preventDefault();try{const t=this.elements.userInput.value.trim();if(!t)throw new Error("User name is mandatory");const s=this.userService.addUser(t);this.addUserToSelect(s.name),this.elements.addUserForm.reset(),m(`User ${s.name} added successfully`),console.log(`User ${s.name} added`)}catch(t){c(t.message),console.error("Error adding user:",t)}}async handleAddExpense(e){e.preventDefault();try{const t=this.elements.expenseUserInput.value.trim(),s=this.elements.expenseAmountInput.valueAsNumber,r=this.elements.expenseReasonInput.value.trim();if(!t)throw new Error("Please select a user");if(!s||s<=0)throw new Error("Please enter an amount greater than zero");const n=this.expenseService.addExpense(t,s,r);this.renderExpense(n),this.elements.expenseAmountInput.value="",this.elements.expenseReasonInput.value="",m(`Expense added by ${t}`),console.log(`Expense added by ${t}:`,n)}catch(t){c(t.message),console.error("Error adding expense:",t)}}handleSimplify(){try{const e=this.expenseService.simplifyExpenses();this.displayResults(e)}catch(e){c(`Error simplifying expenses: ${e.message}`),console.error("Error simplifying expenses:",e)}}handleExport(){try{this.storageService.exportData(),m("Data exported successfully")}catch(e){c(`Export failed: ${e.message}`),console.error("Export error:",e)}}async handleImport(e){try{const t=e.target.files[0];if(!t)return;await this.storageService.importData(t),this.refreshUI(),m("Data imported successfully"),console.log("Data imported successfully")}catch(t){c(`Import failed: ${t.message}`),console.error("Import error:",t)}finally{e.target.value=""}}addUserToSelect(e){const t=o.createOption(e,e);this.elements.expenseUserInput.add(t)}renderExpense(e){const t=e.description!=="No description"?`${e.paidBy} paid ₹${e.amount} for ${e.description}`:`${e.paidBy} paid ₹${e.amount}`,s=o.createListItem(t,"expense-item");this.elements.paymentList.appendChild(s)}displayResults(e){if(o.clearElement(this.elements.resultArea),e.length===0){const t=o.createListItem("All expenses are settled!","no-results");this.elements.resultArea.appendChild(t);return}o.appendFragment(this.elements.resultArea,e,t=>o.createListItem(t,"settlement-item"))}refreshUI(){o.clearElement(this.elements.expenseUserInput);const e=o.createOption("Select User","");this.elements.expenseUserInput.add(e),this.userService.getUserNames().forEach(t=>{this.addUserToSelect(t)}),o.clearElement(this.elements.paymentList),this.expenseService.getAllExpenses().forEach(t=>{this.renderExpense(t)}),o.clearElement(this.elements.resultArea)}}class f{constructor(){this.userService=new E,this.expenseService=new y(this.userService),this.storageService=new g(this.userService,this.expenseService),this.ui=null}init(){try{this.ui=new x(this.userService,this.expenseService,this.storageService),console.log("Expense Splitter App initialized successfully")}catch(e){console.error("Failed to initialize app:",e),c("Failed to initialize application")}}}let d;document.addEventListener("DOMContentLoaded",()=>{d=new f,d.init()});window.addEventListener("load",()=>{d||(d=new f,d.init())});
